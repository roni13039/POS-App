
@{
    ViewBag.Title = "ShowExpiraProductList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model IEnumerable<POSApplication.Models.PurchaseInvoiceDet>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var si = 0;
}

<div class="panel panel-default">
    <div class="panel-heading"><b>Adjust Quantity Of Expire Product</b></div>
    <div class="panel-body">
      
        <div class="table-responsive">
            <table id="datatable" class="table table-responsive table-bordered datatable-show-all ppp TableItemDetails">
                <thead>
                    <tr class="bg-blue">
                        <th class="col-sm-1">
                            @Html.Label("SL No")
                        </th>
                        <th>
                            Barcode Number
                        </th>
                        <th>
                            Product Name
                        </th>
                        <th>
                            ProductCateGory
                        </th>
                        <th>
                            Supplier Name
                        </th>
                        <th>
                        Quantity
                        </th>
                        <th>
                            Expire Date
                        </th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in Model)
                    {
                        si++;
                        <tr>
                            <td>
                                @si
                            </td>
                            <td>
                                @item.SerialNo
                            </td>
                            <td>
                                @item.Product.ProductName
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ProductCategory.CategoryName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.PurchaseInvoiceMa.Supplier.SupplierName)
                            </td>
                            <td>
                                <input type="text" name="quantity" class="quantity"  />    
                                <input type="hidden" name="Id" class="Id" value="@item.Id" />
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ExpireDate)
                            </td>
                           
                          
                            
                        </tr>
                    }
                </tbody>
            </table>

        </div>
   <br><br>
        <div class="form-group">
            <div class="col-md-offset-4 col-lg-10">
                <input type="button" id="Save" value="Save" class="btn btn-success" />
            </div>
        </div>
    
     </div>
</div>

<style>
    #datatable_length {
        margin-top: 15px;
    }
</style>

@section scripts
{
    <script>
        $(document).ready(function ()
        {
            $('#Save').click(function () {

                if (CheckDetailData() == true)
                {
                    SaveData();
                }


            });
            function CheckDetailData()
            {
                if ($('.TableItemDetails tbody tr').length == 1) {
                    Swal.fire({
                        position: 'top',
                        icon: 'error',
                        title: 'Please Enter  Details Item!'

                    });
                    return false;
                }

                var totRow = $('.TableItemDetails tbody tr').length;
            
                for (var i = 0; i < totRow; i++)
                {

                    if ($('Table.TableItemDetails tbody tr').eq(i).find(".quantity").val() == "")
                    {
                        Swal.fire({
                            position: 'top',
                            icon: 'error',
                            title: 'The  quantity is Reqired'

                        });
                        return false;
                    }
                 
                }
                return true;
            }
            function SaveData()
            {
                
                var Id = document.getElementsByName("Id");
                var quantity = document.getElementsByName("quantity");
               
                var DetailsValue = [];
                for (var i = 0; i < quantity.length; i++)
                {

                    DetailsValue.push({
                        quantity: quantity[i].value,
                        Id: Id[i].value
                    });
                }
                $.ajax({
                    url: "/PurchaseInvoice/UpdateProductQtyForExpire",
                    type: "POST",
                    dataType: 'json',
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    data:
                        {
                         DetailsValue: DetailsValue,
                       },
                    success: function (result)
                    {
                   
                        if (result.flag == true)
                        {
                            Swal.fire({
                                position: 'top',
                                icon: 'success',
                                title: 'Successfully Updated!',
                                showConfirmButton: true,
                            }).then((result) => {
                                if (result.value) {
                                    window.location = "/PurchaseInvoice/ExpiraProductList";

                                }
                            })

                        }

                        else {
                            alert("Data Saved Failed");
                        }

                    },
                    error: function () {
                        alert('Something went wrong!');
                    }

                });



            }


        });


    </script>

}


